
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://loum.github.io/makester/makefiles/docker/">
      
      
        <link rel="prev" href="../py/">
      
      
        <link rel="next" href="../compose/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>Docker - Makester</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Makester" class="md-header__button md-logo" aria-label="Makester" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Makester
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
    
  
  Getting started

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../makester/" class="md-tabs__link">
          
  
  Makefiles

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../macos/" class="md-tabs__link">
        
  
    
  
  Extras for macOS

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../utilities/" class="md-tabs__link">
        
  
    
  
  Utilities

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../recipes/" class="md-tabs__link">
        
  
    
  
  Recipes

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../faqs/" class="md-tabs__link">
        
  
    
  
  FAQs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Makester" class="md-nav__button md-logo" aria-label="Makester" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Makester
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Makefiles
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Makefiles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../makester/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Makester
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../py/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#support-for-multi-architecture-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Support for multi-architecture builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-your-target-docker-platforms" class="md-nav__link">
    <span class="md-ellipsis">
      Define your target Docker platforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Image clean up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Command reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-a-local-registry-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a local registry server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-your-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build your Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-buildx-builder" class="md-nav__link">
    <span class="md-ellipsis">
      Create a buildx builder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-docker-images-as-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Run your Docker images as a container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-docker-image-with-the-latest-tag" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Docker image with the latest tag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-docker-image-with-a-custom-versioning-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Docker image with a custom versioning policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-your-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Remove your Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-dangling-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Remove dangling Docker images
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#makester__image_target_tag" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TARGET_TAG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__image_tag_alias" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TAG_ALIAS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__container_name" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__CONTAINER_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__image_tag" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TAG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__run_command" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__RUN_COMMAND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__build_command" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__BUILD_COMMAND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__docker_platform" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__DOCKER_PLATFORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__local_registry" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__LOCAL_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__local_registry_port" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__LOCAL_REGISTRY_PORT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__buildkit_builder_name" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__BUILDKIT_BUILDER_NAME
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Compose
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Versioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/microk8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MicroK8s
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minikube
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/kompose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kompose
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../argocd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Argo CD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../macos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extras for macOS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recipes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#support-for-multi-architecture-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Support for multi-architecture builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-your-target-docker-platforms" class="md-nav__link">
    <span class="md-ellipsis">
      Define your target Docker platforms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Image clean up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Command reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Command reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-a-local-registry-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy a local registry server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-your-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Build your Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-buildx-builder" class="md-nav__link">
    <span class="md-ellipsis">
      Create a buildx builder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-docker-images-as-a-container" class="md-nav__link">
    <span class="md-ellipsis">
      Run your Docker images as a container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-docker-image-with-the-latest-tag" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Docker image with the latest tag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-docker-image-with-a-custom-versioning-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Docker image with a custom versioning policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-your-docker-image" class="md-nav__link">
    <span class="md-ellipsis">
      Remove your Docker image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-dangling-docker-images" class="md-nav__link">
    <span class="md-ellipsis">
      Remove dangling Docker images
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#makester__image_target_tag" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TARGET_TAG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__image_tag_alias" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TAG_ALIAS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__container_name" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__CONTAINER_NAME
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__image_tag" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__IMAGE_TAG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__run_command" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__RUN_COMMAND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__build_command" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__BUILD_COMMAND
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__docker_platform" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__DOCKER_PLATFORM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__local_registry" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__LOCAL_REGISTRY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__local_registry_port" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__LOCAL_REGISTRY_PORT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makester__buildkit_builder_name" class="md-nav__link">
    <span class="md-ellipsis">
      MAKESTER__BUILDKIT_BUILDER_NAME
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="docker">Docker</h1>
<p>Docker is core to <a href="https://github.com/loum/makester.git" target="_blank">Makester</a> for both container image
management and integrating supporting containerised services. For example,
<a href="https://hub.docker.com/r/gittools/gitversion" target="_blank">GitVersion</a>. Wrap your wieldy, common <a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank">Docker
commands</a> into a <code>make</code> target
and start being productive.</p>
<p>The Makester Docker subsystem help lists the available commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>make<span class="w"> </span>docker-help
</code></pre></div>
<h2 id="example">Example</h2>
<p>A <a href="https://github.com/loum/makester/blob/main/resources/sample/Dockerfile" target="_blank">sample Dockerfile</a>
is provided by <a href="https://github.com/loum/makester.git" target="_blank">Makester</a> to demonstrate basic capability.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are running the following commands from Makester which has been setup within your
project repository, then replace <code>resources/sample/Makefile</code> with <code>makester/resources/sample/Makefile</code>.</p>
</div>
<p>To get help at any time:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span><span class="nb">help</span>
</code></pre></div>
<p>Build a Docker image based off the "Hello World" image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-build
</code></pre></div>
<div class="highlight"><span class="filename">Hello World image container runtime output.</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>/usr/bin/docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>supa-cool-repo/my-project:99296c8<span class="w"> </span>sample
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Sending<span class="w"> </span>build<span class="w"> </span>context<span class="w"> </span>to<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w">  </span><span class="m">3</span>.072kB
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Step<span class="w"> </span><span class="m">1</span>/1<span class="w"> </span>:<span class="w"> </span>FROM<span class="w"> </span>hello-world
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w"> </span>---&gt;<span class="w"> </span>d1165f221234
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Successfully<span class="w"> </span>built<span class="w"> </span>d1165f221234
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>Successfully<span class="w"> </span>tagged<span class="w"> </span>supa-cool-repo/my-project:99296c8
</code></pre></div>
<p>The resultant image build can be viewed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-search
</code></pre></div>
<div class="highlight"><span class="filename">Image in Docker.</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>REPOSITORY<span class="w">                  </span>TAG<span class="w">       </span>IMAGE<span class="w"> </span>ID<span class="w">       </span>CREATED<span class="w">         </span>SIZE
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>supa-cool-repo/my-project<span class="w">   </span>52c13b1<span class="w">   </span><span class="m">281099761321</span><span class="w">   </span><span class="m">10</span><span class="w"> </span>months<span class="w"> </span>ago<span class="w">   </span><span class="m">9</span>.14kB
</code></pre></div>
<p>To start a container from the <code>supa-cool-repo/my-project</code> image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>container-run
</code></pre></div>
<p>Makester also supports image builds with
<a href="https://docs.docker.com/build/buildkit/" target="_blank">BuildKit</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-buildx
</code></pre></div>
<div class="highlight"><span class="filename">Hello World image build with BuildKit.</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span><span class="m">0</span>.7s<span class="w"> </span><span class="o">(</span><span class="m">6</span>/6<span class="o">)</span><span class="w"> </span><span class="nv">FINISHED</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span>internal<span class="o">]</span><span class="w"> </span>load<span class="w"> </span>build<span class="w"> </span>definition<span class="w"> </span>from<span class="w"> </span>Dockerfile<span class="w">                                       </span><span class="m">0</span>.0s
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>transferring<span class="w"> </span>dockerfile:<span class="w"> </span>54B<span class="w">                                                        </span><span class="m">0</span>.0s
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span>internal<span class="o">]</span><span class="w"> </span>load<span class="w"> </span>.dockerignore<span class="w">                                                          </span><span class="m">0</span>.0s
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>transferring<span class="w"> </span>context:<span class="w"> </span>2B<span class="w">                                                            </span><span class="m">0</span>.0s
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span>internal<span class="o">]</span><span class="w"> </span>load<span class="w"> </span>metadata<span class="w"> </span><span class="k">for</span><span class="w"> </span>docker.io/library/hello-world:latest<span class="w">                      </span><span class="m">0</span>.6s
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>CACHED<span class="w"> </span><span class="o">[</span><span class="m">1</span>/1<span class="o">]</span><span class="w"> </span>FROM<span class="w"> </span>docker.io/library/hello-world@sha256:aa0cc8055b82dc2509bed2e19b275c<span class="w">  </span><span class="m">0</span>.0s
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>resolve<span class="w"> </span>docker.io/library/hello-world@sha256:aa0cc8055b82dc2509bed2e19b275c8f46350<span class="w">  </span><span class="m">0</span>.0s
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>exporting<span class="w"> </span>to<span class="w"> </span>oci<span class="w"> </span>image<span class="w"> </span>format<span class="w">                                                          </span><span class="m">0</span>.1s
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>exporting<span class="w"> </span>layers<span class="w">                                                                    </span><span class="m">0</span>.0s
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>exporting<span class="w"> </span>manifest<span class="w"> </span>sha256:09fa5bdba956b1732511e681f392cabd75554ffbc85e9ea2c7ee4925<span class="w">  </span><span class="m">0</span>.0s
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>exporting<span class="w"> </span>config<span class="w"> </span>sha256:52cac4254827711f6b1c1c75c516538b7b95656723f8aa6a4f74a9a59b<span class="w">  </span><span class="m">0</span>.0s
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>sending<span class="w"> </span>tarball<span class="w">                                                                     </span><span class="m">0</span>.1s
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>importing<span class="w"> </span>to<span class="w"> </span>docker<span class="w">                                                                    </span><span class="m">0</span>.0s
</code></pre></div>
<p>Makester performs a couple of customisations for you behind the scenes to steamline the image build process
with BuildKit. These include:</p>
<ul>
<li>Identifies your platform and uses that value to set the <code>--platform</code> to <code>docker buildx build</code>.</li>
<li>Adds the <code>--load</code> switch to <code>docker buildx build</code> so that the new image is exported into docker.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Without the <code>--load</code> switch, the <code>docker buildx build</code> process will display the following warning:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>WARNING:<span class="w"> </span>No<span class="w"> </span>output<span class="w"> </span>specified<span class="w"> </span>with<span class="w"> </span>docker-container<span class="w"> </span>driver.<span class="w"> </span>Build<span class="w"> </span>result<span class="w"> </span>will<span class="w"> </span>only<span class="w"> </span>remain<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>build<span class="w"> </span>cache.<span class="w"> </span>To<span class="w"> </span>push<span class="w"> </span>result<span class="w"> </span>image<span class="w"> </span>into<span class="w"> </span>registry<span class="w"> </span>use<span class="w"> </span>--push<span class="w"> </span>or<span class="w"> </span>to<span class="w"> </span>load<span class="w"> </span>image<span class="w"> </span>into<span class="w"> </span>docker<span class="w"> </span>use<span class="w"> </span>--load
</code></pre></div>
</div>
<p>To see the new plan for <code>docker buildx build</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>make<span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-buildx
</code></pre></div>
<div class="highlight"><span class="filename">BuildKit's docker buildx build plan.</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/arm64<span class="w"> </span>--load<span class="w"> </span>-t<span class="w"> </span>supa-cool-repo/my-project:&lt;DOCKER_IMAGE_TAG&gt;<span class="w"> </span>sample
</code></pre></div>
<h3 id="support-for-multi-architecture-builds">Support for multi-architecture builds</h3>
<div class="admonition tag">
<p class="admonition-title"><a href="https://github.com/loum/makester/releases/tag/0.2.2" target="_blank">Makester v0.2.2</a></p>
</div>
<p>Makester can now <a href="https://docs.docker.com/build/building/multi-platform/#:~:text=Support%20on%20Docker%20Desktop,%2C%20ppc64le%20%2C%20and%20even%20s390x%20." target="_blank">Leverage multi-CPU architecture support</a>. However, there are some manual steps that need to be performed.</p>
<h3 id="define-your-target-docker-platforms">Define your target Docker platforms</h3>
<p>To build an image that supports multiple architectures, you can define these by setting the
<code>MAKESTER__DOCKER_PLATFORM</code> Makester variable. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nv">MAKESTER__DOCKER_PLATFORM</span><span class="o">=</span>linux/arm64,linux/amd64<span class="w"> </span>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-buildx
</code></pre></div>
<p>However, in the default docker image build system you may see this error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ERROR:<span class="w"> </span>docker<span class="w"> </span>exporter<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>currently<span class="w"> </span>support<span class="w"> </span>exporting<span class="w"> </span>manifest<span class="w"> </span>lists
</code></pre></div>
<p>To mitigate this error, we will need to create new <code>buildx</code> builder. In this example, we will
call the new builder <code>multiarch</code>. Change this name to suit your requirements::</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>create<span class="w"> </span>--driver-opt<span class="w"> </span><span class="nv">network</span><span class="o">=</span>host<span class="w"> </span>--name<span class="w"> </span>multiarch<span class="w"> </span>--use
</code></pre></div>
<p>Check to ensure that the new <code>multiarch</code> builder has been selected for use (note <code>multiarch *</code>):</p>
<div class="highlight"><span class="filename">List available BuildKit builders.</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>ls
</code></pre></div>
<div class="highlight"><span class="filename">New BuildKit builder is selected.</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>NAME/NODE<span class="w">        </span>DRIVER/ENDPOINT<span class="w">             </span>STATUS<span class="w">   </span>BUILDKIT<span class="w"> </span>PLATFORMS
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>multiarch<span class="w"> </span>*<span class="w">      </span>docker-container
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span>multiarch0<span class="w">     </span>unix:///var/run/docker.sock<span class="w"> </span>running<span class="w">  </span>v0.11.1<span class="w">  </span>linux/arm64,<span class="w"> </span>linux/amd64,<span class="w"> </span>linux/amd64/v2,<span class="w"> </span>linux/riscv64,<span class="w"> </span>linux/ppc64le,<span class="w"> </span>linux/s390x,<span class="w"> </span>linux/386,<span class="w"> </span>linux/mips64le,<span class="w"> </span>linux/mips64,<span class="w"> </span>linux/arm/v7,<span class="w"> </span>linux/arm/v6
</code></pre></div>
<p>Recall that Makester's <code>docker buildx build</code> attempts to load the new image into docker's
registry. However, this is not possible with BuildKit as it runs as a completely different
process. Instead, we can load into a local registry server. Create the server as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>make<span class="w"> </span>image-registry-start
</code></pre></div>
<p>The image tag will also be updated to reflect the local registry server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nv">MAKESTER__DOCKER_PLATFORM</span><span class="o">=</span>linux/arm64,linux/amd64<span class="w"> </span>make<span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-buildx
</code></pre></div>
<div class="highlight"><span class="filename">BuildKit build plan with the local registry server running.</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/arm64,linux/amd64<span class="w"> </span>--push<span class="w"> </span>-t<span class="w"> </span>localhost:15000/supa-cool-repo/my-project:52c13b1<span class="w"> </span>sample
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Makester will make subtle changes to your Docker build command based on whether the local
registry server is running or not. If you experience unexpected behaviour, check the status of your server.</p>
</div>
<p>Now we can build the multi-platform container image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nv">MAKESTER__DOCKER_PLATFORM</span><span class="o">=</span>linux/arm64,linux/amd64<span class="w"> </span>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-buildx
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you receive a <code>:15000: connect: connection refused</code> error, you may need to add the following to
your Docker's <code>daemon.json</code> configuration file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>&quot;insecure-registries&quot; : [
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>&quot;localhost:15000&quot;,
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>&quot;127.0.0.1:15000&quot;,
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>&quot;registry.me:15000&quot;
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>],
</code></pre></div>
</div>
<p>To see the images in your local registry server, first list the catalog:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:15000/v2/_catalog
</code></pre></div>
<div class="highlight"><span class="filename">Local registry server catalog</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="o">{</span><span class="s2">&quot;repositories&quot;</span>:<span class="o">[</span><span class="s2">&quot;supa-cool-repo/my-project&quot;</span><span class="o">]}</span>
</code></pre></div>
<p>Next, get the list of available tags:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:15000/v2/supa-cool-repo/my-project/tags/list
</code></pre></div>
<div class="highlight"><span class="filename">Available tags</span><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;supa-cool-repo/my-project&quot;</span>,<span class="s2">&quot;tags&quot;</span>:<span class="o">[</span><span class="s2">&quot;52c13b1&quot;</span><span class="o">]}</span>
</code></pre></div>
<p>To access the new image from the local registry server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>docker<span class="w"> </span>pull<span class="w"> </span>localhost:15000/supa-cool-repo/my-project:52c13b1
</code></pre></div>
<p>The local registry server can now be terminated:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>make<span class="w"> </span>image-registry-stop
</code></pre></div>
<p>Create a tag to align with the project's naming convention:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>docker<span class="w"> </span>tag<span class="w"> </span>localhost:15000/supa-cool-repo/my-project:52c13b1<span class="w"> </span>supa-cool-repo/my-project:52c13b1
</code></pre></div>
<p>Now it is possible to search for the new, multi-platform image as per normal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-search
</code></pre></div>
<div class="highlight"><span class="filename">Image search for new, multi-platform image in docker output.</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>REPOSITORY<span class="w">                  </span>TAG<span class="w">       </span>IMAGE<span class="w"> </span>ID<span class="w">       </span>CREATED<span class="w">         </span>SIZE
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>supa-cool-repo/my-project<span class="w">   </span>52c13b1<span class="w">   </span>52cac4254827<span class="w">   </span><span class="m">10</span><span class="w"> </span>months<span class="w"> </span>ago<span class="w">   </span><span class="m">9</span>.14kB
</code></pre></div>
<p>Not convinced that the new images have been built with multi-platform support?:</p>
<div class="highlight"><span class="filename">Inspect image architectures.</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>imagetools<span class="w"> </span>inspect<span class="w"> </span>localhost:15000/supa-cool-repo/my-project:52c13b
</code></pre></div>
<div class="highlight"><span class="filename">Image inspect output.</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Name:<span class="w">      </span>localhost:15000/supa-cool-repo/my-project:52c13b1
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>MediaType:<span class="w"> </span>application/vnd.oci.image.index.v1+json
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>Digest:<span class="w">    </span>sha256:6a8497a3199b5a220c175ae8c3d0b11149f04b5191e94fcce49b16bdfd630e98
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>Manifests:
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">  </span>Name:<span class="w">        </span>localhost:15000/supa-cool-repo/my-project:52c13b1@sha256:73752638c848a53e033f1a7db6a1f2459e41cd291edbd4f6356593f915b2da63
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">  </span>MediaType:<span class="w">   </span>application/vnd.oci.image.manifest.v1+json
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">  </span>Platform:<span class="w">    </span>linux/arm64
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">  </span>Name:<span class="w">        </span>localhost:15000/supa-cool-repo/my-project:52c13b1@sha256:86954c5e397fdde46080e1bf13568bce1def33267125d6cbb9220eb0fd0a55f1
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">  </span>MediaType:<span class="w">   </span>application/vnd.oci.image.manifest.v1+json
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span>Platform:<span class="w">    </span>linux/amd64
</code></pre></div>
<h3 id="image-clean-up">Image clean up</h3>
<p>To delete the <code>supa-cool-repo/my-project</code> image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>image-rm
</code></pre></div>
<h2 id="command-reference">Command reference</h2>
<h3 id="deploy-a-local-registry-server">Deploy a local registry server</h3>
<div class="admonition tag">
<p class="admonition-title"><a href="https://github.com/loum/makester/releases/tag/0.1.4" target="_blank">Makester v0.1.4</a></p>
</div>
<p>As per notes on how to <a href="https://docs.docker.com/registry/deploying/" target="_blank">Deploy a registry server</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>make<span class="w"> </span>image-registry-start
</code></pre></div>
<p>The registry can be accessed with <code>curl</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:15000/v2/supa-cool-repo/my-project/tags/list
</code></pre></div>
<p>To stop the local image registry server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>make<span class="w"> </span>image-registry-stop
</code></pre></div>
<h3 id="build-your-docker-image">Build your Docker image</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>make<span class="w"> </span>image-build
</code></pre></div>
<p>Alternatively, leverage the features provided by
<a href="https://docs.docker.com/build/buildkit/" target="_blank">BuildKit</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>make<span class="w"> </span>image-buildx
</code></pre></div>
<h3 id="create-a-buildx-builder">Create a <code>buildx</code> builder</h3>
<p>As per <a href="https://docs.docker.com/engine/reference/commandline/buildx_create/">docker buildx create</a>,
create a <code>buildx</code> builder instance to leverage capabilities provided by BuildKit. Such as
multi-arch image builds:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>make<span class="w"> </span>image-buildx-builder
</code></pre></div>
<p>Override <code>MAKESTER__BUILDKIT_BUILDER_NAME</code> to set the name of the buildx builder instance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nv">MAKESTER__BUILDKIT_BUILDER_NAME</span><span class="o">=</span>my-builder<span class="w"> </span>make<span class="w"> </span>image-buildx-builder
</code></pre></div>
<h3 id="run-your-docker-images-as-a-container">Run your Docker images as a container</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>make<span class="w"> </span>container-run
</code></pre></div>
<p>The <code>container-run</code> target can be controlled in your <code>Makefile</code> by overriding the
<code>MAKESTER__RUN_COMMAND</code> parameter. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>MAKESTER__RUN_COMMAND<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>MAKESTER__DOCKER<span class="k">)</span><span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span><span class="k">$(</span>MAKESTER__CONTAINER_NAME<span class="k">)</span><span class="w"> </span><span class="k">$(</span>MAKESTER__SERVICE_NAME<span class="k">)</span>:<span class="k">$(</span>HASH<span class="k">)</span>
</code></pre></div>
<h3 id="tag-docker-image-with-the-latest-tag">Tag Docker image with the <code>latest</code> tag</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>make<span class="w"> </span>image-tag
</code></pre></div>
<h3 id="tag-docker-image-with-a-custom-versioning-policy">Tag Docker image with a custom versioning policy</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>make<span class="w"> </span>image-tag-version
</code></pre></div>
<p>Version defaults to <code>0.0.0-1</code> but this can be overridden by setting <code>MAKESTER__VERSION</code> and
<code>MAKESTER__RELEASE_NUMBER</code> in your <code>Makefile</code>. Alternatively, to align with your preferred tagging
convention, override the <code>MAKESTER__IMAGE_TAG</code> parameter. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>make<span class="w"> </span>tag<span class="w"> </span><span class="nv">MAKESTER__IMAGE_TAG</span><span class="o">=</span>supa-tag-01
</code></pre></div>
<h3 id="remove-your-docker-image">Remove your Docker image</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>make<span class="w"> </span>image-rm
</code></pre></div>
<h3 id="remove-dangling-docker-images">Remove dangling Docker images</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>make<span class="w"> </span>image-rm-dangling
</code></pre></div>
<h2 id="variables">Variables</h2>
<h3 id="makester__image_target_tag"><code>MAKESTER__IMAGE_TARGET_TAG</code></h3>
<p>Unique identifier used to distinguish container image builds. Defaults to
<a href="../makester/#hash">HASH</a>.</p>
<h3 id="makester__image_tag_alias"><code>MAKESTER__IMAGE_TAG_ALIAS</code></h3>
<p>Convenience variable that is made up of the
<a href="../makester/#makester__service_name">MAKESTER__SERVICE_NAME</a> and <code>MAKESTER__IMAGE_TARGET_TAG</code>. For example:</p>
<div class="highlight"><span class="filename">MAKESTER__SERVICE_NAME sample value</span><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nv">MAKESTER__SERVICE_NAME</span><span class="o">=</span>supa-cool-repo/my-project
</code></pre></div>
<div class="highlight"><span class="filename">MAKESTER__SERVICE_NAME sample value</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nv">MAKESTER__IMAGE_TARGET_TAG</span><span class="o">=</span>52c13b1
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>make<span class="w"> </span>-f<span class="w"> </span>resources/sample/Makefile<span class="w"> </span>print-MAKESTER__IMAGE_TAG_ALIAS
</code></pre></div>
<div class="highlight"><span class="filename">MAKESTER__IMAGE_TAG_ALIAS based on MAKESTER__SERVICE_NAME:MAKESTER__IMAGE_TAG_ALIAS</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nv">MAKESTER__IMAGE_TAG_ALIAS</span><span class="o">=</span>supa-cool-repo/my-project:52c13b1
</code></pre></div>
<h3 id="makester__container_name"><code>MAKESTER__CONTAINER_NAME</code></h3>
<p>Control the name of your image container (defaults to <code>my-container</code>).</p>
<h3 id="makester__image_tag"><code>MAKESTER__IMAGE_TAG</code></h3>
<p>Defaults to <code>latest</code>.</p>
<h3 id="makester__run_command"><code>MAKESTER__RUN_COMMAND</code></h3>
<p>Override the image container run command that is initiated by <code>make container-run</code>.</p>
<h3 id="makester__build_command"><code>MAKESTER__BUILD_COMMAND</code></h3>
<p>Override the command line options to <code>docker build</code> or <code>docker buildx build</code> to have more fine-grained control over the container image build process. For example, the following snippet overrides the image tag:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>MAKESTER__BUILD_COMMAND<span class="w"> </span>:<span class="o">=</span><span class="w"> </span>-t<span class="w"> </span><span class="k">$(</span>MAKESTER__SERVICE_NAME<span class="k">)</span>:<span class="k">$(</span>HASH<span class="k">)</span><span class="w"> </span>.
</code></pre></div>
<h3 id="makester__docker_platform"><code>MAKESTER__DOCKER_PLATFORM</code></h3>
<p>Override the <code>--platform</code> switch to <code>docker buildx</code>.
<a href="#support-for-multi-architecture-builds">Multi-architecture builds</a> are supported.</p>
<h3 id="makester__local_registry"><code>MAKESTER__LOCAL_REGISTRY</code></h3>
<p>The host and IP of the local Docker image registry server which is used to configure
<a href="https://docs.docker.com/registry/deploying/#customize-the-published-port">REGISTRY_HTTP_ADDR</a>.
The default is <code>0.0.0.0:5000</code>. Although it is possible to override this variable, it only controls the
settings that the registry listens on within the container.</p>
<h3 id="makester__local_registry_port"><code>MAKESTER__LOCAL_REGISTRY_PORT</code></h3>
<p><code>MAKESTER__LOCAL_REGISTRY_PORT</code> controls the local registry server host port that you can connect
to. The default is <code>15000</code>. You can override this setting if you detect a clash on port <code>15000</code> or
you want to run multiple local registry servers.</p>
<div class="highlight"><span class="filename">Overriding MAKESTER__LOCAL_REGISTRY_PORT.</span><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nv">MAKESTER__LOCAL_REGISTRY_PORT</span><span class="o">=</span><span class="m">15001</span>
</code></pre></div>
<h3 id="makester__buildkit_builder_name"><code>MAKESTER__BUILDKIT_BUILDER_NAME</code></h3>
<p>The name to give to the
<a href="https://docs.docker.com/engine/reference/commandline/buildx_create/">docker buildx create</a>
builder. Defaults to <code>multiarch</code>.</p>
<hr />
<p><a href="#docker">top</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "header.autohide", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>